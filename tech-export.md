# 音频导出功能开发计划(修订版)

## 阶段一: 最小可用功能(MVP)

### 1. 基础导出功能
✅ 1.1 实现标记验证核心逻辑
- 创建 getValidSegments 函数
- 实现基本的标记验证
- 返回有效的音频片段列表

✅ 1.2 实现简单导出对话框
- 创建基本对话框
- 显示文件列表
- 添加导出按钮

✅ 1.3 实现音频切片基本功能
- 使用 ffmpeg 切分音频
- 实现基本的进度显示
- 添加简单的错误提示

✅ 1.4 实现格式检测和转码
- 使用 ffprobe 检测音频格式
- 智能选择处理模式
- 保留原始参数

✅ 1.5 实现帧对齐处理
- 计算帧时长
- 调整切割点
- 确保音频完整性

### 2. 功能完善
✅ 2.1 完善对话框界面
- 添加更多设置选项
- 优化列表显示
- 改进进度展示

✅ 2.2 增强错误处理
- 添加详细错误信息
- 实现错误恢复
- 优化用户提示

## 阶段二: 性能优化

### 3. 性能提升
✖️ 3.1 实现并行处理
✖️ 3.2 优化内存使用
✖️ 3.3 改进进度计算

## 技术实现细节

### 1. 格式检测
- 使用 ffprobe 获取音频信息
- 检测编码格式和参数
- 确定处理策略

### 2. 帧对齐处理
- MP3 帧大小计算
  * 每帧1152个采样
  * 基于采样率计算时长
- 智能边界调整
  * 向下取整对齐
  * 避免超出音频时长
- 确保音频完整性
  * 验证调整后的时间点
  * 处理边界情况

### 3. 导出流程
1. 格式检测
   - 获取音频格式信息
   - 检测编码参数
   - 选择处理模式

2. 标记验证
   - 检查时间范围
   - 调整到帧边界
   - 验证片段有效性

3. 音频处理
   - 优先使用 copy 模式
   - 必要时进行转码
   - 保留原始参数

4. 进度监控
   - 实时进度更新
   - 支持取消操作
   - 错误恢复机制

## 使用说明
1. 每完成一个步骤后，使用✅标记
2. 未完成或下一步要进行的任务使用✖️标记
3. 每次开发前，先确认当前进度
4. 每次开发后，更新任务状态

## 开发指令
使用以下格式请求下一步开发:
"请开始 [任务编号] [任务名称] 的开发"

例如:
"请开始 3.1 实现并行处理 的开发"
